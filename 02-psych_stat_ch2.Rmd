# 第2章 分布の記述的指標とその性質  {-}

## 2.1.1 中央値(p.19-20)  {-}

- 教科書の数値例を`x`というオブジェクトに代入します。  

```{r}
x <- c(4, 9, 14, 16, 15)
x
```

- 代表値の候補として$t = 10$を取り上げたとき  

<div class="alert alert-info">
絶対値を計算するには，`abs()`関数を使います。  
</div>  

```{r}
abs(x - 10)
sum(abs(x - 10))
```  

- 代表値として$t = 14$を取り上げたとき  

<div class="alert alert-info">
中央値の計算には，`median()`関数を使います。  
</div>  

```{r}
median(x)
abs(x - 14)
sum(abs(x - 14))
```  



## 2.1.2 平均(p.20-23)  {-}

- 教科書の数値例(`x`)の平均を求めます。  

```{r}
mean(x)
```  

- ベクトルの合計を計算する`sum()`関数で足し合わせ，個数で割っても同じ値が出ます。  

```{r}
sum(x) / 5
```  

- (2.3)式の$T _{2}$を求めます。  

```{r}
sum((x - mean(x))^2)
```  

## 2.1.3 逸脱行動データの代表値(p.24-25)   {-}

- 逸脱行動データを`dat`というオブジェクトに読み込みます。  

```{r}
dat <- read.csv(file = "data/itsudatsu_data.csv")
```  

- 男子だけのデータ，女子だけのデータを抽出し，`dat_M`，`dat_F`というオブジェクトに代入します。  

```{r}
dat_M <- dat[dat$sex == 1,]
dat_F <- dat[dat$sex == 2,]
```  

- 男子の小6の時の逸脱行動得点，中2の時の逸脱行動得点，変化量の中央値を求めます。  

```{r}
median(dat_M$Grade_6th)
median(dat_M$Grade_8th)
median(dat_M$diff)
```  

- 男女別にそれぞれ計算するのは手間なので，記述統計を一度に算出する便利な関数を使います。  

- 今回は`psych`パッケージに含まれている`describe()`関数を使います。  
- `psych`パッケージは初めて使用する際にインストールが必要です。  
<br>
- 初めて使用するときには，以下のコードを入力してください。

```{r eval = FALSE}
install.packages("psych")
```

- 1回インストールしたら，上記のコードは実行する必要はありません。  
- `describe()`関数を使うため，`library()`関数で`psych`パッケージを読み込みます。

```{r}
library(psych)
```  

- `describe()`関数を使って全体の記述統計を計算します。  

```{r}
describe(dat)
```  

- 出力結果のうち，`id`行と`sex`行は無視してください(p.24の注釈を読んでください)。  
- 出力結果の`mean`，`median`という列が平均と中央値を意味します。  
<br>
- 男女ごとに記述統計を算出したい場合には，同じ`psych`パッケージに含まれている,
グループごとに記述統計を算出する`describeBy()`関数を使うと便利です。  

<div class="alert alert-info">
`describeBy()`関数の引数である`group`はどのグループで分けるか指定することができます。今回，男女別で記述統計を算出したいので，`dat`に含まれている変数`sex`を使ってグループ分けします。  
</div> 

```{r}
describeBy(dat, group = dat$sex)
```  

## 2.1.4 合成変数の平均(p.25-26)   {-}

- 「変化量の平均 = 中2の時の平均 - 小6の時の平均」が成り立っていることを確認します。  

```{r}
mean(dat$diff)
mean(dat$Grade_8th) - mean(dat$Grade_6th)
```  

- 中央値では上記の関係が成り立たないことを確認します。  

```{r}
median(dat$diff)
median(dat$Grade_8th) - median(dat$Grade_6th)
```  

## 2.1.5 合併した集団における平均(p.26-27)   {-}

- 「全体の平均 = (男子の平均 + 女子の平均) /2」という関係が成り立っていることを確認します。ここでは変化量を例に計算します。    

```{r}
dat_M$diff
dat_F$diff
mean(dat$diff)
(mean(dat_M$diff + mean(dat_F$diff))) / 2
```  

- 中央値では成り立たないことを確認します。  

```{r}
median(dat$diff)
(median(dat_M$diff + median(dat_F$diff))) / 2
```  


## 2.2.1 平均偏差(p.28-29) {-}  

- 図2-1のデータで平均偏差を計算します。  
- `x`というオブジェクトにデータを代入します(2.1の演習で代入している場合には再度行う必要はありません)。  
```{r}
x <- c(4, 9, 14, 16, 15)
```  

- (2.9)式は$T _{1}$の式の$t$に中央値$Med$を代入しています。  

$$
MD = \frac{1}{N}\sum ^{N} _{i =1} |x _{i} - Med|\tag{2.9}\\
$$  

- (2.9)式をコードで記述すると以下のようになります。  

```{r}
mean(abs(x - median(x)))
```  

- 中央値の代わりに平均$\bar{x}$を代入した(2.10)式は以下のコードで計算できます。  

```{r}
mean(abs(x - mean(x)))
```  

## 2.2.2 分散と標準偏差(p.30-31) {-}  

- 図2-1のデータで(2.12)式で表される分散を計算します。  

```{r}
x
mean((x - mean(x))^2)
```  

- 分散の平方根をとる標準偏差((2.13)式)は以下のコードで計算します。  

```{r}
sqrt(mean((x - mean(x))^2))
```  

## 2.2.3 不偏分散(p.31-32) {-}  

- 不偏分散は分母が$N - 1$の(2.14)式で定義されます。  

$$
s ^{\prime 2} = \frac{1}{N - 1}\sum ^{N} _{i = 1} (x _{i} - \bar{x}) ^{2}\tag{2.14}\\
$$  

- 先ほどのデータ`x`で不偏分散を計算してみましょう。  

<div class="alert alert-info">
ベクトルの個数を調べるには`length()`関数を使います。   
</div>  

```{r}
sum((x - mean(x))^2) / (length(x) - 1) 
```

- Rで分散を求める関数は，`var()`関数です。`var()`関数は**不偏分散**を計算します。  

```{r}
var(x)
```  

- また，Rで標準偏差を計算する`sd()`関数は，不偏分散の平方根を計算します。  

```{r}
sd(x)
sqrt(sum((x - mean(x))^2) / (length(x) - 1) )
```  

## 2.2.4 合成変数の分散(p.34-36) {-}  

- Rには(2.12)式で定義される分散(標本分散)を計算する関数が準備されていません。  
- (2.12)式を新たに`bunsan()`関数として定義しましょう。  

```{r}
bunsan <- function(x){
  mean((x - mean(x))^2)
}
```  

- 表2-2の全体での変化量の分散$s ^{2}$を，`bunsan()`関数を使って計算します。  

```{r}
bunsan(dat$diff)
```  

- 小６ と中2の分散の和を計算します。  

```{r}
bunsan(dat$Grade_6th) + bunsan(dat$Grade_8th)
```  

## 2.2.5 合併した集団における分散(p.36-37) {-}  

- 小6のときの逸脱行動得点について全体での分散を(2.19)式を使って計算してみましょう。  
- 第1項を求めます。  

```{r}
n1 <- ((length(dat_M$Grade_6th) * bunsan(dat_M$Grade_6th)) + (length(dat_F$Grade_6th) * bunsan(dat_F$Grade_6th))) / (length(dat_M$Grade_6th) + length(dat_F$Grade_6th))
n1
```  

- 第2項も同様に計算します。  

```{r}
n2 <- length(dat_M$Grade_6th) * length(dat_F$Grade_6th) * ((mean(dat_M$Grade_6th) - mean(dat_F$Grade_6th))^2) / (length(dat_M$Grade_6th) + length(dat_F$Grade_6th))^2
n2
```  

- 全体での分散を計算します。  

```{r}
n1 + n2
```  

- `bunsan()`関数を使って求めた全体の分散のと一致していることがわかります。  

```{r}
bunsan(dat$Grade_6th)
```  

## 2.3.1 線形変換に伴う指標値の変化(p.38) {-}     

- 図2-1のデータ`x`に対して，2倍して3を足すという変換を行い，`new_x`というオブジェクトに代入します。  

```{r}
x <- c(4, 9, 14, 16, 15)
x
new_x <- (x * 2) + 3
new_x
```  

- 平均値が(2.21)式の関係になっているか確認します。  

```{r}
mean(x)
mean(new_x)
(mean(x) * 2) + 3
```  

## 2.3.2 変数の標準化(p.38-39) {-}  

- データ`x`が平均0，標準偏差1となるように(z得点となるように)，(2.26)式に従って変換を行いましょう。  

```{r}
(x - mean(x)) / sqrt(mean((x - mean(x))^2))
```  

- `bunsan()`関数を用いて計算すると以下のコードになります(実行してエラーが出る場合には，もう一度`bunsan()`関数を定義するコードを実行してください)。  

```{r}
(x - mean(x)) / sqrt(bunsan(x))
```  

- Rには標準化(z得点化)を行う`scale()`関数がありますが，<u>不偏分散の平方根で割るので上記の計算と値が異なります。</u>詳しくは`?scale`でヘルプを確認してください。  


```{r}
scale(x)
```  

- `scale()`関数のうち，`attr(,"scaled:center")`は平均値，`attr(,"scaled:scale")`は標準偏差を表しています。`attr(,"scaled:scale")`を確認すると，不偏分散の平方根をとったものであることが確認できます。  

## 2.3.3 標準偏差の解釈について(p.40-41) {-}  

- `pnorm()`関数を使って，"平均$\pm$標準偏差"の範囲に全体の68.3%が含まれることを確認しましょう。  
- z得点は平均0，標準偏差1となるように変換されているので，$0 \pm 1$で-1から1の範囲について計算します。  

```{r}
pnorm(1, mean = 0, sd = 1) - pnorm(-1, mean = 0, sd = 1)
```  

- 逸脱行動得点の変化量を使って，"平均$\pm$標準偏差"の範囲に何人が含まれるか計算してみましょう。  

- 変化量の標準偏差を計算します。    

```{r}
sqrt(bunsan(dat$diff))
```  

- 範囲の上限を`Hi_1sd`，下限を`Lo_1sd`というオブジェクトに代入します。  

```{r}
Hi_1sd <- mean(dat$diff) + sqrt(bunsan(dat$diff))
Lo_1sd <- mean(dat$diff) - sqrt(bunsan(dat$diff))
Hi_1sd
Lo_1sd
```  

- `dat$diff`の値のうち，`Hi_1sd`から`Lo_1sd`の範囲に含まれている値のみを抽出し，`dat_diff_1sd`というオブジェクトに代入します。    

```{r}
dat$diff
dat_diff_1sd <- subset(dat$diff, Hi_1sd >= dat$diff  & dat$diff >= Lo_1sd) 
dat_diff_1sd
```  

- 最後に割合を計算します。  

```{r}
length(dat_diff_1sd)
(length(dat_diff_1sd) / length(dat$diff)) * 100
```  

## 2.3 演習問題 {-}  

### 問題1 {-} 

- データ`x`について，
  1. `bunsan()`関数で分散を計算して下さい。  
  1. データ`x`の不偏分散を計算してください。  
  1. `bunsan()`関数の結果が不偏分散の値となるように変換してください。  

<div class="alert alert-info">
- データ`x`は図2-1で用いたものになります。  

```{r}
x <- c(4, 9, 14, 16, 15)
x
```

- `bunsan()`関数は以下のコードで定義します。  

```{r}
bunsan <- function(x){
  mean((x - mean(x))^2)
}
```  
</div>
<br>
- 対応する章：2.2.3 不偏分散，2.2.4 合成変数の分散 

### 問題2  {-} 

- データ`x`に対して2倍して3を足す($c = 2, d = 3$)という線形変換を行った`new_x`について，元の`x`と`new_x`の平均偏差，標準偏差，分散の関係を確認してください。  

<div class="alert alert-info">
`new_x`は以下のコードで作成します。  

```{r}
x <- c(4, 9, 14, 16, 15)
new_x <- (x * 2) + 3
```

</div>

1. `x`と`new_x`の平均偏差をそれぞれ求め，(2.22)式の関係になっているか確認してください。    
1. `x`と`new_x`の標準偏差をそれぞれ求め，(2.23)式の関係になっているか確認してください。  
1. `x`と`new_x`の分散をそれぞれ求め，(2.24)式の関係になっているか確認してください。  
<br>
- 対応する章：2.3.1 線形変換に伴う指標値の変化  

### 問題3 {-}  

- データ`x`の偏差値を計算してください。    
<br>
- 対応する章：2.3.2 変数の標準化  

### 問題4 {-}  

1. データ`x`を(2.26)式に従って標準化し，`z_score`というオブジェクトに代入してください。  
2. データ`x`に対して`scale()`関数を使って標準化した値(`scale(x)`の結果)と同じになるように，`z_score`を変換してください。  
<br>
- 対応する章：2.3.2 変数の標準化  

### 問題5 {-}  

- `pnorm()`関数を使って，"平均$\pm2\times$標準偏差"の範囲に全体の95.5%が含まれることを確認して下さい。  
<br>
- 対応する章：2.3.3 標準偏差の解釈について  


### 問題6 {-}  

- 逸脱行動得点の変化量を使って，"平均$\pm2\times$標準偏差"の範囲に何人が含まれるか計算してください。  
- ただし，範囲の上限を`Hi_2sd`，下限を`Lo_2sd`というオブジェクトに代入して計算を行ってください。  
- `dat$diff`の値のうち，`Hi_2sd`から`Lo_2sd`の範囲に含まれている値は，`dat_diff_2sd`というオブジェクトに代入してください。

<div class="alert alert-info">
- データ`dat`は以下のコードで読み込みます。    

```{r}
dat <- read.csv(file = "data/itsudatsu_data.csv")
```  
</div>
<br>
- 対応する章：2.3.3 標準偏差の解釈について  

