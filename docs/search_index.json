[
["第8章-平均値差と連関に関する推測.html", "第8章 平均値差と連関に関する推測 ", " 第8章 平均値差と連関に関する推測 "],
["データと基本統計量p-225-227.html", "8.1.1 データと基本統計量(p.225 - 227)", " 8.1.1 データと基本統計量(p.225 - 227) 教科書p.226の表8-1にある50組の母子の協調性データを表すkyocho_data.csvファイルをダウンロードしてください。ダウンロード後，「psych_stat」フォルダの「data」フォルダの中に移動してください。 kyochoというオブジェクト名でデータをRに読み込みます。read.csv関数を使ってデータを読み込みます。 kyocho &lt;- read.csv(file = &quot;data/kyocho_data.csv&quot;) 読み込んだkyochoデータの冒頭と末尾6行を確認します。 head(kyocho) ## Mother year kyocho ## 1 12 2 6 ## 2 12 2 11 ## 3 7 2 11 ## 4 17 3 13 ## 5 14 2 13 ## 6 9 2 10 tail(kyocho) ## Mother year kyocho ## 45 13 2 13 ## 46 11 3 9 ## 47 14 2 11 ## 48 16 4 14 ## 49 12 2 16 ## 50 12 2 8 1列目Motherは「母親価値」，yearは「通園年数」，kyochoは「協調性」の列を表しています。1行目から50行目まで読み込まれていることを確認してください。 表8-2にある基本統計量を算出します。今回，母親価値，通園年数，協調性の3つの列についてそれぞれ平均を求める必要があります。行と列をもつデータ構造で列平均を求めるにはcolMeans()関数を使います(Mが大文字であることを注意してください)。 colMeans(kyocho) ## Mother year kyocho ## 13.20 2.48 11.96 標準偏差(標本分散の正の平方根)をそれぞれ計算して求めます。 sqrt(mean((kyocho$Mother - mean(kyocho$Mother))^2)) ## [1] 2.424871 sqrt(mean((kyocho$year - mean(kyocho$year))^2)) ## [1] 0.7547185 sqrt(mean((kyocho$kyocho - mean(kyocho$kyocho))^2)) ## [1] 2.481612 相関係数を求めます。 cor()関数に行と列を持つデータを代入すると相関行列を計算します。相関行列は対角線を挟んで対称となるので，教科書の表8-2では右下のほうのみ掲載しています。 cor(kyocho) ## Mother year kyocho ## Mother 1.0000000 0.5376770 0.4799263 ## year 0.5376770 1.0000000 0.5014633 ## kyocho 0.4799263 0.5014633 1.0000000 "],
["残差への注目p-227-229.html", "8.1.2 残差への注目(p.227 - 229)", " 8.1.2 残差への注目(p.227 - 229) \\(x _{1}\\)(Mother)によって\\(x _{2}\\)(year)を予測する回帰分析を行い，残差\\(x _{2}|x _{1}\\)を計算しましょう。 教科書第3章(p.54)の(3.13)，(3.14)式より予測値\\(\\hat{x} _{2}\\)(hat_year)を求めます。 \\[ \\begin{align} \\hat{y} &amp;= a + bx \\tag{3.11}\\\\ b &amp;= r\\frac{s _{y}}{s _{x}} \\tag{3.13}\\\\ a &amp;= \\bar{y} - b \\bar{x} \\tag{3.14}\\\\ \\end{align} \\] b &lt;- cor(kyocho$Mother, kyocho$year) * (sd(kyocho$year) / sd(kyocho$Mother)) a &lt;- mean(kyocho$year) - b * mean(kyocho$Mother) hat_year &lt;- a + b * kyocho$Mother 残差は実際の値(year)と予測値(hat_year)とのずれなので，引き算で求めます。 e_year &lt;- kyocho$year - hat_year e_year ## [1] -0.2791837 -0.2791837 0.5575510 -0.1159184 -0.6138776 0.2228571 ## [7] 1.0555102 0.5534694 0.2187755 -1.2791837 0.7208163 0.2187755 ## [13] -0.1118367 -0.6138776 0.8840816 -1.1159184 1.0514286 0.2187755 ## [19] 1.2187755 0.0555102 -0.2791837 -0.7771429 -0.2791837 -0.2791837 ## [25] 0.5493878 -0.1118367 0.3861224 -0.7812245 0.2187755 0.2187755 ## [31] -0.9485714 0.2187755 -0.2791837 0.0555102 0.8881633 -1.2791837 ## [37] -0.7812245 0.5534694 -0.7812245 -0.2791837 -0.2791837 0.7208163 ## [43] 0.5534694 -0.1159184 -0.4465306 0.8881633 -0.6138776 1.0514286 ## [49] -0.2791837 -0.2791837 残差\\(x _{2}|x _{1}\\)(e_year)を求めました。残差の性質として，平均が0となります(p.58,(3.18)式)。0となるか確認しましょう。 mean(e_year) ## [1] -1.376481e-16 指数表示となっていますが，round()関数で数値を丸めると0であることがわかります。 round(mean(e_year), digits = 3) ## [1] 0 求めた残差\\(x _{2}|x _{1}\\)を使って図8-3を作図してみましょう。 plot(e_year, kyocho$kyocho, las = 1, bty = &quot;l&quot;, tcl = 0.2, pch = 16, xlim = c(-1.5, 1.5), xaxp = c(-1.5, 1.5, 6)) 図8-3には，残差\\(x _{2}|x _{1}\\)によって子どもの協調性得点\\(y\\)を予測する回帰直線が書き込まれています。 先ほど\\(x _{2}\\)から\\(x _{1}\\)を予測するときには回帰直線の切片\\(a\\)と傾き\\(b\\)を計算で求めました。 Rには回帰分析を行うためのlm()関数があります(使い方は演習サイトの第3章3.1.1を確認してください)。 lm()関数ではformulaというクラスのオブジェクトを使います。formulaオブジェクトでは，チルダ(~)の前に従属年数，後ろに独立変数を入力します。 lm_kyocho_zansa &lt;- lm(kyocho$kyocho ~ e_year) summary(lm_kyocho_zansa) ## ## Call: ## lm(formula = kyocho$kyocho ~ e_year) ## ## Residuals: ## Min 1Q Median 3Q Max ## -5.646 -1.818 0.574 1.731 4.354 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 11.9600 0.3429 34.875 &lt;2e-16 *** ## e_year 1.1259 0.5389 2.089 0.042 * ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 2.425 on 48 degrees of freedom ## Multiple R-squared: 0.08335, Adjusted R-squared: 0.06425 ## F-statistic: 4.364 on 1 and 48 DF, p-value: 0.04202 lm()関数の計算結果を代入したオブジェクトをabline()関数に入れると回帰直線を書き込んでくれます。先ほど作図した図8-3にlm()関数を使って計算したlm_zansa_kyochoの回帰直線を上書きします。abline()関数は必ずplot()関数と同時に実行するようにしてください。 plot(e_year, kyocho$kyocho, las = 1, bty = &quot;l&quot;, tcl = 0.2, pch = 16, xlim = c(-1.5, 1.5), xaxp = c(-1.5, 1.5, 6)) abline(lm_kyocho_zansa) 図から比較的右肩上がりの関係が読み取れます。弱いながらも正の相関があることがわかります。 "],
["部分相関係数p-229-230.html", "8.1.3 部分相関係数(p.229 - 230)", " 8.1.3 部分相関係数(p.229 - 230) lm()関数を使うと，計算結果をまとめたオブジェクトの中に残差の値も格納されます。先ほど計算した残差\\(x _{2}|x _{1}\\)(e_year)をlm()関数を使って求めましょう。 lm_year_Mother &lt;- lm(kyocho$year ~ kyocho$Mother) 残差はlm()関数の計算結果を格納したオブジェクトの中のresidualsにあります。 lm_year_Mother$residuals ## 1 2 3 4 5 6 7 ## -0.2791837 -0.2791837 0.5575510 -0.1159184 -0.6138776 0.2228571 1.0555102 ## 8 9 10 11 12 13 14 ## 0.5534694 0.2187755 -1.2791837 0.7208163 0.2187755 -0.1118367 -0.6138776 ## 15 16 17 18 19 20 21 ## 0.8840816 -1.1159184 1.0514286 0.2187755 1.2187755 0.0555102 -0.2791837 ## 22 23 24 25 26 27 28 ## -0.7771429 -0.2791837 -0.2791837 0.5493878 -0.1118367 0.3861224 -0.7812245 ## 29 30 31 32 33 34 35 ## 0.2187755 0.2187755 -0.9485714 0.2187755 -0.2791837 0.0555102 0.8881633 ## 36 37 38 39 40 41 42 ## -1.2791837 -0.7812245 0.5534694 -0.7812245 -0.2791837 -0.2791837 0.7208163 ## 43 44 45 46 47 48 49 ## 0.5534694 -0.1159184 -0.4465306 0.8881633 -0.6138776 1.0514286 -0.2791837 ## 50 ## -0.2791837 e_year ## [1] -0.2791837 -0.2791837 0.5575510 -0.1159184 -0.6138776 0.2228571 ## [7] 1.0555102 0.5534694 0.2187755 -1.2791837 0.7208163 0.2187755 ## [13] -0.1118367 -0.6138776 0.8840816 -1.1159184 1.0514286 0.2187755 ## [19] 1.2187755 0.0555102 -0.2791837 -0.7771429 -0.2791837 -0.2791837 ## [25] 0.5493878 -0.1118367 0.3861224 -0.7812245 0.2187755 0.2187755 ## [31] -0.9485714 0.2187755 -0.2791837 0.0555102 0.8881633 -1.2791837 ## [37] -0.7812245 0.5534694 -0.7812245 -0.2791837 -0.2791837 0.7208163 ## [43] 0.5534694 -0.1159184 -0.4465306 0.8881633 -0.6138776 1.0514286 ## [49] -0.2791837 -0.2791837 (8.1)式に基づいて\\(x_{2} | x _{1}\\)と\\(y\\)との相関係数(部分相関係数\\(r _{y(2|1)}\\)を求めましょう。 \\[ r _{y(2|1)} = \\frac{r _{y2} - r_{y1}r _{12}}{\\sqrt{1 - r ^{2} _{12}}} \\tag{8.1} \\] (cor(kyocho$year, kyocho$kyocho) - (cor(kyocho$kyocho, kyocho$Mother) * cor(kyocho$Mother, kyocho$year))) / sqrt(1 - cor(kyocho$Mother, kyocho$year)^2) ## [1] 0.2887003 先ほど計算した残差と子どもの協調性得点(kyocho$kyocho)の相関を求めましょう。 cor(lm_year_Mother$residuals, kyocho$kyocho) ## [1] 0.2887003 残差を実際に求めた結果と(8.1)式に基づいて計算した結果が一致することがわかります。 "],
["偏相関係数p-230-232.html", "8.1.4 偏相関係数(p.230 - 232)", " 8.1.4 偏相関係数(p.230 - 232) 8.1.2では残差\\(x _{2}| x_{1}\\)をlm()関数を用いて求めました。今回は，残差\\(y|x _{1}\\)をlm()関数を使って求めましょう。 lm_kyocho_Mother &lt;- lm(kyocho$kyocho ~ kyocho$Mother) lm_kyocho_Mother $residuals ## 1 2 3 4 5 6 7 ## -5.3706122 -0.3706122 2.0851701 -0.8263946 0.6470748 0.1028571 -0.3882993 ## 8 9 10 11 12 13 14 ## 3.1382313 -1.8440816 -0.3706122 4.6293878 1.1559184 -0.8794558 0.6470748 ## 15 16 17 18 19 20 21 ## -1.8263946 1.1736054 2.6647619 1.1559184 1.1559184 -2.3882993 1.6293878 ## 22 23 24 25 26 27 28 ## 2.1028571 0.6293878 -0.3706122 1.1912925 -1.8794558 -0.3529252 0.1559184 ## 29 30 31 32 33 34 35 ## 0.1559184 1.1559184 -1.3352381 2.1559184 -3.3706122 1.6117007 0.1205442 ## 36 37 38 39 40 41 42 ## -5.3706122 -0.8440816 3.1382313 -3.8440816 1.6293878 -2.3706122 -0.3706122 ## 43 44 45 46 47 48 49 ## 2.1382313 -1.8263946 1.1382313 -1.8794558 -1.3529252 0.6647619 4.6293878 ## 50 ## -3.3706122 残差\\(x _{2} | x _{1}\\)と残差\\(y | x _{1}\\)の散布図(図8-4)を作図しましょう。 plot(lm_year_Mother$residuals, lm_kyocho_Mother$residuals, las = 1, bty = &quot;l&quot;, tcl = 0.2, pch = 16, xlim = c(-1.5, 1.5), xaxp = c(-1.5, 1.5, 6), ylim = c(-6, 6), yaxp = c(-5, 5, 5)) 同じように残差\\(x _{2} | x _{1}\\)と残差\\(y | x _{1}\\)の回帰分析を行い，回帰直線を上書きします。 lm_zansa_zansa &lt;- lm(lm_kyocho_Mother$residuals ~ lm_year_Mother$residuals) plot(lm_year_Mother$residuals, lm_kyocho_Mother$residuals, las = 1, bty = &quot;l&quot;, tcl = 0.2, pch = 16, xlim = c(-1.5, 1.5), xaxp = c(-1.5, 1.5, 6), ylim = c(-6, 6), yaxp = c(-5, 5, 5)) abline(lm_zansa_zansa) (8.2)式に基づいて\\(y\\)と\\(x _{2}\\)の偏相関係数\\(r _{y 2|1}\\)を求めます。 (cor(kyocho$kyocho, kyocho$year) - (cor(kyocho$kyocho, kyocho$Mother) * cor(kyocho$Mother, kyocho$year))) /(sqrt(1 - cor(kyocho$kyocho, kyocho$Mother) ^2) * sqrt(1 - cor(kyocho$Mother, kyocho$year) ^2)) ## [1] 0.3290749 "],
["偏回帰係数p-232-234.html", "8.2.1 偏回帰係数(p.232 - 234)", " 8.2.1 偏回帰係数(p.232 - 234) (8.5)式に基づいて\\(x _{2} | x _{1}\\)から\\(y\\)を予測するときの回帰係数\\(b _{y(2|1)}\\)を求めます。 \\[ \\begin{align} b _{y(2|1)} &amp;= r _{y(2|1)}\\frac{s _{y}}{s _{2|1}}\\\\ &amp;= \\frac{r _{y2} - r _{y1} r_{12}}{\\sqrt{1 - r ^{2} _{12}}} \\times \\frac{s _{y}}{s _{2}\\sqrt{1 - r ^{2} _{12}}}\\\\ &amp;= \\frac{r _{y2} - r _{y1} r_{12}}{1 - r ^{2} _{12}} \\times \\frac{s _{y}}{s _{2}}\\tag{8.5}\\\\ \\end{align} \\] (cor(kyocho$kyocho, kyocho$year) - (cor(kyocho$kyocho, kyocho$Mother) * cor(kyocho$Mother, kyocho$year))) / (1 - cor(kyocho$Mother, kyocho$year)^2) * (sd(kyocho$kyocho) / sd(kyocho$year)) ## [1] 1.125877 図8-3と図8-4を作図するときに，それぞれlm()関数で回帰分析を行いました。傾きの係数を比較します。 summary(lm_kyocho_zansa) ## ## Call: ## lm(formula = kyocho$kyocho ~ e_year) ## ## Residuals: ## Min 1Q Median 3Q Max ## -5.646 -1.818 0.574 1.731 4.354 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 11.9600 0.3429 34.875 &lt;2e-16 *** ## e_year 1.1259 0.5389 2.089 0.042 * ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 2.425 on 48 degrees of freedom ## Multiple R-squared: 0.08335, Adjusted R-squared: 0.06425 ## F-statistic: 4.364 on 1 and 48 DF, p-value: 0.04202 summary(lm_zansa_zansa) ## ## Call: ## lm(formula = lm_kyocho_Mother$residuals ~ lm_year_Mother$residuals) ## ## Residuals: ## Min 1Q Median 3Q Max ## -5.0563 -1.4780 -0.0563 1.4751 4.9437 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 2.424e-16 2.967e-01 0.000 1.0000 ## lm_year_Mother$residuals 1.126e+00 4.663e-01 2.414 0.0196 * ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 2.098 on 48 degrees of freedom ## Multiple R-squared: 0.1083, Adjusted R-squared: 0.08971 ## F-statistic: 5.829 on 1 and 48 DF, p-value: 0.01962 出力結果のうち，Coefficientsの段にあるEstimateの列を確認してください。(Intercept)が切片\\(a\\)，その下の行(e_year)の値が傾き\\(b\\)を表します。lm_zansa_zansaは指数表示となっていますがe+00なので小数点の移動はありません。どちらも値が同じ事が確認できます。 "],
["標準偏回帰係数p-234-235.html", "8.2.2 標準偏回帰係数(p.234 - 235)", " 8.2.2 標準偏回帰係数(p.234 - 235) (8.7)式に基づいて標準偏回帰係数\\(b ^{\\ast} _{y(2|1)}\\)を求めます。 (cor(kyocho$kyocho, kyocho$year) - (cor(kyocho$kyocho, kyocho$Mother) * cor(kyocho$Mother, kyocho$year))) / (1 - cor(kyocho$Mother, kyocho$year)^2) ## [1] 0.3424065 (8.7)式の結果と，データを標準化してlm()関数を用いて求めた傾きが一致するか確認します。 変数\\(x _{2}\\)(通園年数year)および\\(y\\)(協調性kyocho)を標準化して標準偏回帰係数を求めましょう。まずはそれぞれの標準偏差をs_2，s_yというオブジェクトに代入します。 s_2 &lt;- sqrt(mean((kyocho$year - mean(kyocho$year))^2)) s_y &lt;- sqrt(mean((kyocho$kyocho - mean(kyocho$kyocho))^2)) 標準化したデータをstd_2，std_yというオブジェクトに代入します。 std_2 &lt;- (kyocho$year - mean(kyocho$year)) /s_2 std_y &lt;- (kyocho$kyocho - mean(kyocho$kyocho)) /s_y lm()関数を用いて残差\\(x ^{\\ast} _{2}|x _{1}\\)を求めます(\\(x ^{\\ast}\\)は標準化された変数\\(x _{2}\\)を表しています)。 lm_std2_x1 &lt;- lm(std_2 ~kyocho$Mother) lm_std2_x1$residuals ## 1 2 3 4 5 6 ## -0.36991763 -0.36991763 0.73875362 -0.15359153 -0.81338613 0.29528512 ## 7 8 9 10 11 12 ## 1.39854822 0.73334547 0.28987697 -1.69491498 0.95507972 0.28987697 ## 13 14 15 16 17 18 ## -0.14818338 -0.81338613 1.17140582 -1.47858888 1.39314007 0.28987697 ## 19 20 21 22 23 24 ## 1.61487432 0.07355087 -0.36991763 -1.02971223 -0.36991763 -0.36991763 ## 25 26 27 28 29 30 ## 0.72793732 -0.14818338 0.51161122 -1.03512038 0.28987697 0.28987697 ## 31 32 33 34 35 36 ## -1.25685463 0.28987697 -0.36991763 0.07355087 1.17681397 -1.69491498 ## 37 38 39 40 41 42 ## -1.03512038 0.73334547 -1.03512038 -0.36991763 -0.36991763 0.95507972 ## 43 44 45 46 47 48 ## 0.73334547 -0.15359153 -0.59165188 1.17681397 -0.81338613 1.39314007 ## 49 50 ## -0.36991763 -0.36991763 最後に回帰分析を行います。 lm_std &lt;- lm(std_y ~lm_std2_x1$residuals) summary(lm_std) ## ## Call: ## lm(formula = std_y ~ lm_std2_x1$residuals) ## ## Residuals: ## Min 1Q Median 3Q Max ## -2.2750 -0.7328 0.2313 0.6976 1.7546 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 2.485e-16 1.382e-01 0.000 1.000 ## lm_std2_x1$residuals 3.424e-01 1.639e-01 2.089 0.042 * ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 0.9772 on 48 degrees of freedom ## Multiple R-squared: 0.08335, Adjusted R-squared: 0.06425 ## F-statistic: 4.364 on 1 and 48 DF, p-value: 0.04202 傾きを確認すると3.424e-01とあります。これは3.424の\\(10 ^{-1}\\)を表しています。Rで計算するときは，3.424 * 10 ^(-1)というコードを計算してください。小数点が前に一つ移動して，0.3424となり，(8.7)式で計算した結果と一致することがわかります。 "],
["最小2乗法による母数の推定p-238-240.html", "8.3.1 最小2乗法による母数の推定(p.238 - 240)", " 8.3.1 最小2乗法による母数の推定(p.238 - 240) (8.15)式から(8.17)式に基づいて\\(b _{1}\\)，\\(b _{2}\\)，\\(a\\)を計算しましょう。 b_1 &lt;- (cor(kyocho$kyocho, kyocho$Mother) - (cor(kyocho$kyocho, kyocho$year) * cor(kyocho$Mother, kyocho$year))) / (1 - cor(kyocho$Mother, kyocho$year)^2) * (sd(kyocho$kyocho) / sd(kyocho$Mother)) b_2 &lt;- (cor(kyocho$kyocho, kyocho$year) - (cor(kyocho$kyocho, kyocho$Mother) * cor(kyocho$Mother, kyocho$year))) / (1 - cor(kyocho$Mother, kyocho$year)^2) * (sd(kyocho$kyocho) / sd(kyocho$year)) a &lt;- mean(kyocho$kyocho) - b_1 * mean(kyocho$Mother) - b_2 * mean(kyocho$year) b_1 ## [1] 0.3027444 b_2 ## [1] 1.125877 a ## [1] 5.171599 lm()関数で重回帰分析をおこなった結果と比較します。 lm_multi &lt;- lm(kyocho$kyocho ~ kyocho$Mother + kyocho$year) summary(lm_multi) ## ## Call: ## lm(formula = kyocho$kyocho ~ kyocho$Mother + kyocho$year) ## ## Residuals: ## Min 1Q Median 3Q Max ## -5.0563 -1.4780 -0.0563 1.4751 4.9437 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 5.1716 1.6647 3.107 0.0032 ** ## kyocho$Mother 0.3027 0.1467 2.064 0.0446 * ## kyocho$year 1.1259 0.4713 2.389 0.0210 * ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 2.12 on 47 degrees of freedom ## Multiple R-squared: 0.3137, Adjusted R-squared: 0.2845 ## F-statistic: 10.74 on 2 and 47 DF, p-value: 0.000144 同様の結果が得られていることがわかります。 (8.18)式，(8.19)式に従って標準偏回帰係数を計算しましょう。 b_1_ast &lt;- (cor(kyocho$kyocho, kyocho$Mother) - (cor(kyocho$kyocho, kyocho$year) * cor(kyocho$Mother, kyocho$year))) / (1 - cor(kyocho$Mother, kyocho$year)^2) b_2_ast &lt;- (cor(kyocho$kyocho, kyocho$year) - (cor(kyocho$kyocho, kyocho$Mother) * cor(kyocho$Mother, kyocho$year))) / (1 - cor(kyocho$Mother, kyocho$year)^2) b_1_ast ## [1] 0.2958223 b_2_ast ## [1] 0.3424065 "],
["重相関係数p-240-241.html", "8.3.2 重相関係数(p.240 - 241)", " 8.3.2 重相関係数(p.240 - 241) (8.20)式に基づいて重相関係数を求めましょう。 sqrt((cor(kyocho$kyocho, kyocho$Mother) ^2 + cor(kyocho$kyocho, kyocho$year)^2 -2 * cor(kyocho$kyocho, kyocho$Mother) * cor(kyocho$kyocho, kyocho$year) * cor(kyocho$Mother, kyocho$year)) / (1 - cor(kyocho$Mother, kyocho$year) ^2)) ## [1] 0.5600689 従属変数\\(y\\)と予測値\\(\\hat{y}\\)の相関係数を求め，値が一致するか確認します。予測値を求めるには，predict()関数を用います。 predict()関数は第一引数にlm()関数の結果を代入したオブジェクト，第二引数にデータを指定することで予測値\\(\\hat{y}\\)の値を返してくれます。第二引数を指定しなければ推定時に用いたデータが用いられます。 lm_multi_pre &lt;- predict(lm_multi) lm_multi_pre ## 1 2 3 4 5 6 7 8 ## 11.056286 11.056286 9.542564 13.695885 11.661775 10.148053 11.576674 12.484907 ## 9 10 11 12 13 14 15 16 ## 13.090396 9.930409 12.182163 13.090396 10.753541 11.661775 14.821762 12.570008 ## 17 18 19 20 21 22 23 24 ## 14.519017 13.090396 14.216273 10.450797 11.056286 9.022176 11.056286 11.056286 ## 25 26 27 28 29 30 31 32 ## 15.427250 10.753541 12.787652 11.964519 13.090396 13.090396 12.267263 13.090396 ## 33 34 35 36 37 38 39 40 ## 11.056286 10.450797 11.879418 9.930409 11.964519 12.484907 11.964519 11.056286 ## 41 42 43 44 45 46 47 48 ## 11.056286 12.182163 12.484907 13.695885 11.359030 11.879418 11.661775 14.519017 ## 49 50 ## 11.056286 11.056286 相関係数を計算します。 cor(kyocho$kyocho, lm_multi_pre) ## [1] 0.5600689 値が一致していることがわかります。 "],
["独立変数間の相関と重相関係数p-244-245.html", "8.4.1 独立変数間の相関と重相関係数(p.244 - 245)", " 8.4.1 独立変数間の相関と重相関係数(p.244 - 245) 重相関係数を求める(8.20)式を関数として定義します。重相関係数の計算は\\(r _{y1}, r_{y2}, r_{12}\\)の3つが必要になります。関数の引数としてそれぞれr_y1，r_y2，r_12とし，重相関係数を計算するmulti_cor()関数を定義します。 multi_cor &lt;- function(r_y1, r_y2, r_12){ sqrt((r_y1 ^2 + r_y2 ^2 -2 * r_y1 * r_y2 * r_12) / (1 - r_12 ^2)) } 定義したmulti_cor()関数を使って教科書p.244の計算を行います。multi_cor()関数の第一引数には，\\(r _{y1}\\)，第二引数には\\(r_{y2}\\)，第三引数には\\(r_{12}\\)の値を代入してください。 独立変数間の相関を.\\(r = .54\\)から\\(r = .1\\)に変更(協調性と母親価値との相関，協調性と通園年数との相関は変更なし) multi_cor(r_y1 = .48, r_y2 = .50, r_12 = .1) ## [1] 0.660884 独立変数間の相関をゼロに変更 multi_cor(r_y1 = .48, r_y2 = .50, r_12 = 0) ## [1] 0.6931089 独立変数間の相関を\\(r = -.5\\) multi_cor(r_y1 = .48, r_y2 = .50, r_12 = -0.5) ## [1] 0.980068 定義したmulti_cor()関数を使って図8-7を作図してみます。まずは\\(r _{y1} = r_{y2}= .2\\)の時を作図します。 x &lt;- seq(-1, 1, 0.01) plot(x, multi_cor(r_y1 = 0.2, r_y2 = 0.2, r_12 = x), type = &quot;l&quot;, las = 1, bty = &quot;l&quot;, tcl = 0.2, xlim = c(-1, 1), xaxp = c(-1, 1, 20), ylim = c(0, 1), yaxp = c(0, 1, 5)) \\(r _{y1} = r_{y2}= .4\\)の線を赤色，と\\(r _{y1} = r_{y2}= .6\\)の線を青色で上書きします。 x &lt;- seq(-1, 1, 0.01) plot(x, multi_cor(r_y1 = 0.2, r_y2 = 0.2, r_12 = x), type = &quot;l&quot;, las = 1, bty = &quot;l&quot;, tcl = 0.2, xlim = c(-1, 1), xaxp = c(-1, 1, 20), ylim = c(0, 1), yaxp = c(0, 1, 5)) lines(x, multi_cor(r_y1 = 0.4, r_y2 = 0.4, r_12 = x), col = &quot;red&quot;) lines(x, multi_cor(r_y1 = 0.6, r_y2 = 0.6, r_12 = x), col = &quot;blue&quot;) abline(v = 0) legend(&quot;bottomleft&quot;, legend = c(&quot;r_y1 = r_y2 = .2&quot;,&quot;r_y1 = r_y2 = .4&quot;,&quot;r_y1 = r_y2 = .6&quot;), col = c(&quot;black&quot;,&quot;red&quot;, &quot;blue&quot;), lty = 1) "],
["平方和の分割p-250-251.html", "8.5.1 平方和の分割(p.250 - 251)", " 8.5.1 平方和の分割(p.250 - 251) (8.27)式の関係が成り立っているか確認しましょう。全体の平方和\\(SS_{y}\\)をSS_y，予測値の平方和\\(SS_\\hat{y}\\)をSS_haty，残差の平方和\\(SS_{e}\\)をSS_eとします。 SS_y &lt;- sum((kyocho$kyocho - mean(kyocho$kyocho))^2) SS_haty &lt;- sum((lm_multi_pre - mean(lm_multi_pre))^2) SS_e &lt;- sum((lm_multi$residuals - mean(lm_multi$residuals))^2) SS_y ## [1] 307.92 SS_haty + SS_e ## [1] 307.92 SS_hatyとSS_eの和がSS_yに一致することがわかります。 表8-1の重相関係数をmulti_cor()関数を使って計算しましょう。 R &lt;- multi_cor(r_y1 = cor(kyocho$kyocho, kyocho$Mother), r_y2 = cor(kyocho$kyocho, kyocho$year), r_12 = cor(kyocho$Mother, kyocho$year)) R ## [1] 0.5600689 (8.28)式に従って分散説明率を計算します。 SS_haty / SS_y ## [1] 0.3136772 表8-1の重相関係数の2乗と一致するか確認します。 R ^2 ## [1] 0.3136772 同じ値が計算できました。 lm()関数では，分散説明率が出力結果に表示されます。もう一度結果を確認しましょう。 summary(lm_multi) ## ## Call: ## lm(formula = kyocho$kyocho ~ kyocho$Mother + kyocho$year) ## ## Residuals: ## Min 1Q Median 3Q Max ## -5.0563 -1.4780 -0.0563 1.4751 4.9437 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 5.1716 1.6647 3.107 0.0032 ** ## kyocho$Mother 0.3027 0.1467 2.064 0.0446 * ## kyocho$year 1.1259 0.4713 2.389 0.0210 * ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 2.12 on 47 degrees of freedom ## Multiple R-squared: 0.3137, Adjusted R-squared: 0.2845 ## F-statistic: 10.74 on 2 and 47 DF, p-value: 0.000144 出力結果の下から2行目を確認してください。Multiple R-squaredという箇所に分散説明率が表示されています。先ほど求めた分散説明率(Rの2乗)と結果が一致しています。 "],
["予測の標準誤差と自由度調整済み重相関係数p-252-253.html", "8.5.2 予測の標準誤差と自由度調整済み重相関係数(p.252 - 253)", " 8.5.2 予測の標準誤差と自由度調整済み重相関係数(p.252 - 253) (8.33)式の予測の標準誤差\\(s_{e}\\)を求めます。 s_e &lt;- sqrt(mean((kyocho$kyocho - mean(kyocho$kyocho))^2)) * sqrt(1 - R^2) s_e ## [1] 2.055882 (8.34)式の予測の標準誤差\\(s ^{\\prime} _{e}\\)を求めます。 s_e * sqrt(50 / (50 - 2 - 1)) ## [1] 2.12048 (8.35)式に基づく自由度調整済み決定係数\\(R ^{2} _{adj}\\)を計算します。 1 - ((50 - 1) / (50 - 2 - 1)) * (1 - R^2) ## [1] 0.2844719 (8.34)式に基づく予測の標準誤差\\(s ^{\\prime} _{e}\\)と自由度調整済み決定係数\\(R ^{2} _{adj}\\)はlm()関数の出力結果に表示されています。再度，lm()関数の結果を確認します。 summary(lm_multi) ## ## Call: ## lm(formula = kyocho$kyocho ~ kyocho$Mother + kyocho$year) ## ## Residuals: ## Min 1Q Median 3Q Max ## -5.0563 -1.4780 -0.0563 1.4751 4.9437 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 5.1716 1.6647 3.107 0.0032 ** ## kyocho$Mother 0.3027 0.1467 2.064 0.0446 * ## kyocho$year 1.1259 0.4713 2.389 0.0210 * ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 2.12 on 47 degrees of freedom ## Multiple R-squared: 0.3137, Adjusted R-squared: 0.2845 ## F-statistic: 10.74 on 2 and 47 DF, p-value: 0.000144 予測の標準誤差\\(s ^{\\prime} _{e}\\)はResidual standard error，自由度調整済み決定係数\\(R ^{2} _{adj}\\)はAdjusted R-squaredの箇所に表示されています。(8.34)式，(8.35)式に基づく計算結果と同じ値が表示されていることが確認できます。 "],
["重相関係数の検定p-253-255.html", "8.5.3 重相関係数の検定(p.253 - 255)", " 8.5.3 重相関係数の検定(p.253 - 255) (8.37)式に基づいて\\(F\\)統計量の値を計算します。 (R ^2 / 2) / ((1 - R^2) / 47) ## [1] 10.74045 自由度(2,47)のF分布を確認してみましょう。 \\(F\\)分布の確率密度関数はdf()関数，上側確率に対応する値を計算するにはqf()関数を用います。df()関数の第一引数には確率密度を求めたい値，第二引数df1には分子の自由度，第三引数df2に分母の自由度を指定します。 x &lt;- seq(0, 15, 0.01) plot(x, df(x, df1 = 2, df2 = 47), type = &quot;l&quot;, las = 1, bty = &quot;l&quot;, tcl = 0.2, xlab = &quot;F&quot;) 分子の自由度2,分母の自由度47の\\(F\\)分布の上側確率.05に対応する値を確認しましょう。 qf(0.950, 2, 47) ## [1] 3.195056 計算された\\(F\\)統計量の値は3.195よりも大きいため，5%水準で棄却されます。 分子の自由度2,分母の自由度47のF分布で計算された\\(F\\)統計量の値より小さい値が得られる確率を計算します。 pf((R ^2 / 2) / ((1 - R^2) / 47), df1 = 2, df2 =47, lower.tail = FALSE) ## [1] 0.0001440186 計算した\\(F\\)統計量の値とその\\(p\\)値はlm()関数の一番下の行に表示されています。 summary(lm_multi) ## ## Call: ## lm(formula = kyocho$kyocho ~ kyocho$Mother + kyocho$year) ## ## Residuals: ## Min 1Q Median 3Q Max ## -5.0563 -1.4780 -0.0563 1.4751 4.9437 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 5.1716 1.6647 3.107 0.0032 ** ## kyocho$Mother 0.3027 0.1467 2.064 0.0446 * ## kyocho$year 1.1259 0.4713 2.389 0.0210 * ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 2.12 on 47 degrees of freedom ## Multiple R-squared: 0.3137, Adjusted R-squared: 0.2845 ## F-statistic: 10.74 on 2 and 47 DF, p-value: 0.000144 "],
["独立変数の寄与の検定p-256-258.html", "8.5.4 独立変数の寄与の検定(p.256 - 258)", " 8.5.4 独立変数の寄与の検定(p.256 - 258) (8.44)式に基づいて偏回帰係数\\(b _{2}\\)の優位性の検定のための\\(F\\)統計量の値を求めましょう。 (R^2 - cor(kyocho$kyocho, kyocho$Mother)^2) / ((1 - R^2) / 47) ## [1] 5.707737 分子の自由度1，分母の自由度47の\\(F\\)分布の上側確率.05に対応する値を求めます。 qf(0.950, 1, 47) ## [1] 4.0471 計算された\\(F\\)統計量は4.0471よりも大きいので5%水準で棄却され，偏回帰係数\\(b_{2}\\)は統計的に有意であることがわかります。 (補足)：分子の自由度1，分母の自由度47の\\(F\\)分布において，求めた\\(F\\)統計量の値より小さい値が得られる確率を計算します。 pf((R^2 - cor(kyocho$kyocho, kyocho$Mother)^2) / ((1 - R^2) / 47), df1 = 2, df2 =47, lower.tail = FALSE) ## [1] 0.006038009 \\(p\\)値が0.05よりも小さいので帰無仮説は棄却され，統計的に有意であるといえます。 "],
["偏回帰係数の標準誤差を用いた検定p-260-262.html", "8.5.5 偏回帰係数の標準誤差を用いた検定(p.260 - 262)", " 8.5.5 偏回帰係数の標準誤差を用いた検定(p.260 - 262) (8.47)式に従って\\(t\\)統計量の値を求めます。 s_b2 &lt;- (s_e * sqrt(50 / (50 - 2 - 1))) / (sqrt(50) * sqrt(mean((kyocho$year - mean(kyocho$year))^2)) * sqrt(1 - cor(kyocho$Mother,kyocho$year)^2)) b_2 / s_b2 ## [1] 2.389087 自由度47の\\(t\\)分布の上側確率.05に対応する値を計算します。 qt(0.975, df = 47) ## [1] 2.011741 計算された\\(t\\)統計量の値はこの値よりも大きいので，5%水準の両側検定で棄却され偏回帰係数\\(b _{2}\\)は統計的に有意であることがわかります。 (補足)：自由度47の\\(t\\)分布において，求めた\\(t\\)統計量の値より小さい値が得られる確率を計算します。 pt(b_2 / s_b2, df = 47, lower.tail = FALSE) ## [1] 0.01047807 \\(p\\)値が0.05よりも小さいので帰無仮説は棄却され，統計的に有意であるといえます。 "],
["第8章演習問題.html", "8.6 第8章演習問題", " 8.6 第8章演習問題 以下のコードを実行してください。 kyocho &lt;- read.csv(file = &quot;data/kyocho_data.csv&quot;) 問題1 協調性データを用いて，(8.1)式に基づく部分相関係数\\(r _{y(2|1)}\\)を計算してください(\\(r _{y(2|1)}\\)は8.1.3で一度求めています)。計算結果をpart_corというオブジェクトに代入してください。 問題2 協調性データを用いて，(8.2)式に基づく偏相関係数\\(r _{y2|1}\\)を計算してください(8.1.4で一度求めています)。同様に，計算結果をpartial_corというオブジェクトに代入してください。 問題3 問題1，問題2で計算を行ったpart_cor，partial_corを用いて(8.3)式の関係が成り立つか確認してください。 問題4 (8.2)，(8.4)，(8.6)式を用いて，\\(x _{2}|x _{1}\\)から\\(y | x _{1}\\)を予測するときの回帰係数\\(b _{y2|1}\\)の式が(8.5)式と一致することを確認してください(この問題は提出する必要はありません)。 問題5 協調性データを標準化します。 s_1 &lt;- sqrt(mean((kyocho$Mother - mean(kyocho$Mother))^2)) s_2 &lt;- sqrt(mean((kyocho$year - mean(kyocho$year))^2)) s_y &lt;- sqrt(mean((kyocho$kyocho - mean(kyocho$kyocho))^2)) std_1 &lt;- (kyocho$Mother - mean(kyocho$Mother)) /s_1 std_2 &lt;- (kyocho$year - mean(kyocho$year)) /s_2 std_y &lt;- (kyocho$kyocho - mean(kyocho$kyocho)) /s_y 変数\\(x _1\\)(母親価値)，変数\\(x_2\\)(通園年数)，変数\\(y\\)(協調性得点)を標準化したstd_1，std_2，std_yがそれぞれ平均0，標準偏差1になっているか確認してください。 問題6 標準化したstd_1，std_2，std_yを用いて重回帰分析を行ってください。出力結果の標準偏回帰係数が(8.18)式，(8.19)式の結果と一致することを確認してください。 問題7 標準化したstd_2，std_yを用いて残差変数\\(x_{2} | x _{1}\\)，および\\(y |x _{1}\\)を求め，その標準偏差が\\(\\sqrt{1 - r ^2 _{12}}\\)，\\(\\sqrt{1 - r ^2 _{y1}}\\)となることを確認してください(教科書p.234)。 問題8 (8.27)式にある全体の平方和\\(SS_{y}\\)をSS_y，予測値の平方和\\(SS_\\hat{y}\\)をSS_haty，残差の平方和\\(SS_{e}\\)をSS_eというオブジェクトに計算結果を代入します。 lm_multi &lt;- lm(kyocho$kyocho ~ kyocho$Mother + kyocho$year) lm_multi_pre &lt;- predict(lm_multi) SS_y &lt;- sum((kyocho$kyocho - mean(kyocho$kyocho))^2) SS_haty &lt;- sum((lm_multi_pre - mean(lm_multi_pre))^2) SS_e &lt;- sum((lm_multi$residuals - mean(lm_multi$residuals))^2) 重相関係数\\(R\\)を求め，(8.29)式の関係が成立するか確認してください。 問題9 協調性データについて，独立変数が\\(x _{1}\\)のみであったモデルに\\(x _{2}\\)を追加したときの\\(x_{2}\\)の寄与に関する\\(F\\)値((8.44)式)，(8.47)式の\\(t\\)統計量の値を求め，\\(F\\)値が\\(t\\)値の2乗の関係になっているか確認してください(教科書p.262)。 "]
]
